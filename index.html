<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Libreria Scolastica</title>
    <link href="https://fonts.googleapis.com/css2?family=Lora:wght@400;700&family=Merriweather:wght@400;700&display=swap" rel="stylesheet">
    <style>
       /* Aggiorna il corpo e imposta un colore di sfondo più rilassante */
body {
    font-family: 'Lora', serif; /* Font più elegante */
    background-color: #f5f3e6; /* Colore di sfondo chiaro simile alla carta */
    color: #333;
    margin: 0;
    padding: 0;
}

/* Contenitore centrale con bordi arrotondati */
.container {
    width: 80%;
    margin: 50px auto;
    background-color: #fff; /* Bianco puro per contrastare con il beige dello sfondo */
    padding: 30px;
    box-shadow: 0px 10px 30px rgba(0, 0, 0, 0.1); /* Ombra più pronunciata per un effetto 3D */
    border-radius: 12px;
    transition: box-shadow 0.3s ease;
}

/* Header accattivante con immagine */
header {
    background-image: url('sfondo_libreria.jpg'); /* Cambia questa immagine con una libreria */
    background-size: cover;
    background-position: center;
    color: #fff;
    padding: 60px 0;
    text-align: center;
    font-size: 45px;
    letter-spacing: 1px;
    font-weight: bold;
    text-shadow: 2px 2px 5px rgba(0, 0, 0, 0.5);
}

/* Paragrafo del sottotitolo con font più elegante */
header p {
    font-size: 20px;
    margin-top: 10px;
    text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.3);
    font-family: 'Merriweather', serif;
}

/* Stile per la tabella dei libri */
table {
    width: 100%;
    border-collapse: collapse;
    margin-bottom: 25px;
    background-color: #fff;
    border-radius: 8px;
}

/* Bordi arrotondati e sfumature per i titoli della tabella */
th {
    background-color: #37474F; /* Grigio scuro elegante */
    color: white;
    padding: 20px;
    font-size: 18px;
    border-top-left-radius: 8px;
    border-top-right-radius: 8px;
}

/* Celle della tabella con bordi più morbidi */
td {
    padding: 15px;
    text-align: left;
    font-size: 16px;
    border-bottom: 1px solid #ddd;
    background-color: #fafafa; /* Colore più chiaro per migliorare la leggibilità */
}

tr:hover {
    background-color: #f0f0f0; /* Effetto hover più delicato */
}

/* Pulsanti migliorati */
button {
    padding: 12px 25px;
    background-color: #FF6F61; /* Colore rosso caldo, tipico delle librerie */
    color: white;
    border: none;
    cursor: pointer;
    font-size: 15px;
    font-family: 'Roboto', sans-serif;
    border-radius: 8px;
    transition: background-color 0.3s ease, transform 0.2s ease;
}

button:hover {
    background-color: #FF3B3B; /* Effetto hover più acceso */
    transform: translateY(-3px);
    box-shadow: 0px 8px 15px rgba(0, 0, 0, 0.1);
}

/* Imposta un'ombra più sottile e colori grigi per i pulsanti disabilitati */
button:disabled {
    background-color: #bdbdbd;
    cursor: not-allowed;
}

/* Aggiungi margini extra intorno alla tabella */
table, .container {
    margin-top: 20px;
}
/* Stile per il campo di ricerca */
.search-container {
    text-align: center;
    margin-bottom: 20px;
}

#searchInput {
    width: 50%;
    padding: 12px;
    font-size: 16px;
    border: 2px solid #ddd;
    border-radius: 8px;
    transition: border-color 0.3s ease;
}

#searchInput:focus {
    border-color: #FF6F61; /* Cambia colore quando si seleziona il campo di ricerca */
    outline: none;
}

    </style>
</head>
<body>
<h1>Libreria Scolastica</h1>
<div class="search-container">
<input type="text" id="searchInput" placeholder="Cerca per titolo o autore..." onkeyup="filtraLibri()" />
</div>
<table id="libriTable" border="1">
    <thead>
        <tr>
            <th>ID</th>
            <th>Titolo</th>
            <th>Autore</th>
            <th>Disponibilità</th>
            <th>Azione</th>
        </tr>
    </thead>
    <tbody>
        <!-- I dati dei libri verranno aggiunti qui -->
    </tbody>
</table>

<script>
    // ID del foglio di Google Sheets
    const sheetId = '1bHmR_g_8Rp54M1lLnZd3nD78EqRTIKNSzl1mE2-hRzQ';
    
    // API key del progetto Google Cloud
    const apiKey = 'AIzaSyCBAMHlMKwdPs8hlvRnxxNOWwdXxqnKC3k';

    // URL per ottenere i dati dal foglio Google Sheets
    const url = `https://sheets.googleapis.com/v4/spreadsheets/${sheetId}/values/libreriaprincipale?key=${apiKey}`;

    // Funzione per caricare i libri dal Google Sheets
    async function caricaLibri() {
        const response = await fetch(url);
        const data = await response.json();
        const libri = data.values;

        // Seleziona il corpo della tabella dove verranno inseriti i dati
        const tbody = document.querySelector('#libriTable tbody');

        // Rimuoviamo la prima riga poiché contiene i nomi delle colonne
        libri.shift();

        libri.forEach(libro => {
            const [id, titolo, autore, disponibilita] = libro;

            // Creiamo una nuova riga nella tabella per ogni libro
            const tr = document.createElement('tr');

            // Creiamo le celle per ID, Titolo, Autore e Disponibilità
            tr.innerHTML = `
                <td>${id}</td>
                <td>${titolo}</td>
                <td>${autore}</td>
                <td id="disponibilita-${id}">${disponibilita}</td>
                <td>
                    ${disponibilita === 'Disponibile' 
                        ? `<button onclick="prendiInPrestito(${id})">Prendi in Prestito</button>`
                        : `<button onclick="restituisciLibro(${id})">Restituisci</button>`}
                </td>
            `;

            // Aggiungiamo la riga alla tabella
            tbody.appendChild(tr);
        });

setInterval(async () => {
    const response = await fetch(url);
    const data = await response.json();
    const libri = data.values;
    libri.shift();
    libri.forEach(libro => {
        const [id, , , disponibilita] = libro;
        const buttonCell = document.querySelector(`#disponibilita-${id}`).nextElementSibling;
        const disponibilitaCell = document.querySelector(`#disponibilita-${id}`);
        
        if (disponibilita === 'In Prestito') {
            buttonCell.innerHTML = `<button onclick="restituisciLibro(${id})">Restituisci</button>`;
            disponibilitaCell.textContent = 'In Prestito';
        } else {
            buttonCell.innerHTML = `<button onclick="prendiInPrestito(${id})">Prendi in Prestito</button>`;
            disponibilitaCell.textContent = 'Disponibile';
        }
    });
}, 10000); // Controlla ogni 10 secondi


        
    }

  // Funzione per aprire il modulo di prestito con l'ID del libro precompilato
function prendiInPrestito(idLibro) {
    const urlModuloPrestito = `https://docs.google.com/forms/d/e/1FAIpQLScUNgMUgKa_URu74Ju3G1HZXDMVlNMzX1D2egxB7Ut34wzIqg/viewform?entry.1518254211=${idLibro}`;
    window.open(urlModuloPrestito, '_blank');
}

// Funzione per aprire il modulo di restituzione con l'ID del libro precompilato
function restituisciLibro(idLibro) {
    const urlModuloRestituzione = `https://docs.google.com/forms/d/e/1FAIpQLSfqR3bdauSlexTrCqcPnn05kjbOnE4utylDPUoIdRHqheSYCg/viewform?entry.300178690=${idLibro}`;
    window.open(urlModuloRestituzione, '_blank');
}

// Funzione per filtrare i libri in base al titolo o autore
function filtraLibri() {
    // Ottieni il valore dell'input di ricerca
    var input = document.getElementById("searchInput");
    var filtro = input.value.toLowerCase(); // Converte in minuscolo per una ricerca case-insensitive
    
    // Ottieni la tabella e tutte le righe
    var table = document.getElementById("libriTable");
    var tr = table.getElementsByTagName("tr");

    // Loop attraverso tutte le righe della tabella (tr) e nascondi quelle che non corrispondono alla query
    for (var i = 1; i < tr.length; i++) { // Inizia da 1 per saltare l'intestazione della tabella
        var tdTitolo = tr[i].getElementsByTagName("td")[1]; // Colonna Titolo
        var tdAutore = tr[i].getElementsByTagName("td")[2]; // Colonna Autore
        if (tdTitolo || tdAutore) {
            var txtTitolo = tdTitolo.textContent || tdTitolo.innerText;
            var txtAutore = tdAutore.textContent || tdAutore.innerText;
            
            // Se il titolo o l'autore contengono il testo cercato, mostra la riga, altrimenti nascondila
            if (txtTitolo.toLowerCase().indexOf(filtro) > -1 || txtAutore.toLowerCase().indexOf(filtro) > -1) {
                tr[i].style.display = "";
            } else {
                tr[i].style.display = "none";
            }
        }
    }
}

    // Carichiamo i libri appena la pagina viene caricata
    caricaLibri();
</script>

</body>
</html>



