<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Libreria Scolastica</title>
    <link href="https://fonts.googleapis.com/css2?family=Lora:wght@400;700&family=Merriweather:wght@400;700&display=swap" rel="stylesheet">
    <style>
/* Reset di base */
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

/* Body */
body {
    font-family: 'Inter', sans-serif;
    background-color: #fac960; /* Giallo come nel sito che hai indicato */
    color: #333;
    padding: 0;
    margin: 0;
}

/* Barra di navigazione fissa e minimale */
.navbar {
    background-color: white; /* Barra bianca */
    color: #333;
    padding: 10px 0; /* Riduce l'altezza della barra per renderla minimal */
    text-align: center;
    position: fixed;
    width: 100%;
    top: 0;
    left: 0;
    z-index: 1000;
    box-shadow: 0px 4px 6px rgba(0, 0, 0, 0.1);
    font-weight: 700;
    font-size: 24px; /* Dimensione più ridotta per il titolo */
    font-family: 'Inter', sans-serif;
}

/* Spazio per compensare la barra di navigazione fissa */
body {
    padding-top: 60px; /* Ridotto per adattarsi alla barra minimale */
}

/* Contenitore della barra di ricerca */
.search-container {
    text-align: center;
    margin: 40px auto;
}

/* Barra di ricerca moderna */
#searchInput {
    width: 50%;
    padding: 15px;
    font-size: 16px;
    border: 1px solid #ddd;
    border-radius: 25px;
    transition: all 0.3s ease;
    box-shadow: 0px 4px 12px rgba(0, 0, 0, 0.1);
}

#searchInput:focus {
    outline: none;
    border-color: #ffcc00; /* Giallo come nel sito Space */
    box-shadow: 0px 6px 20px rgba(255, 204, 0, 0.4);
}

/* Contenitore per la tabella */
.container {
    width: 85%;
    margin: 0 auto;
    background-color: white;
    padding: 30px;
    border-radius: 12px;
    box-shadow: 0px 10px 30px rgba(0, 0, 0, 0.1);
    margin-bottom: 50px;
}

/* Tabella */
table {
    width: 100%;
    border-collapse: collapse;
}

th, td {
    text-align: left;
    padding: 18px;
    border-bottom: 1px solid #e0e0e0;
}

th {
    background-color: #333;
    color: white;
    font-size: 18px;
    text-transform: uppercase;
    font-weight: 600;
}

td {
    background-color: #fff;
    font-size: 16px;
}

/* Pulsanti gialli */
button {
    padding: 10px 20px;
    background-color: #fac960; /* Giallo come nel sito Space */
    color: white;
    border: none;
    cursor: pointer;
    font-size: 15px;
    border-radius: 25px;
    transition: all 0.3s ease;
}

button:hover {
    background-color: #ff9900;
    box-shadow: 0px 4px 10px rgba(0, 0, 0, 0.1);
}

button:disabled {
    background-color: #ccc;
    cursor: not-allowed;
}

/* Responsive */
@media screen and (max-width: 768px) {
    #searchInput {
        width: 90%;
    }

    table, th, td {
        font-size: 14px;
    }

    button {
        width: 100%;
    }

    .navbar h1 {
        font-size: 20px; /* Riduce la dimensione del titolo su dispositivi mobili */
    }
}


    </style>
</head>
<body>
<!-- Barra di navigazione fissa -->
<header class="navbar">
    <h1>Libreria Scolastica I.C. Alta Val di Sole</h1>
</header>

<div class="search-container">
    <input type="text" id="searchInput" placeholder="Cerca per titolo o autore..." onkeyup="filtraLibri()">
</div>
<div class="container">
    <table id="libriTable">
        <thead>
            <tr>
                <th>ID</th>
                <th>Titolo</th>
                <th>Autore</th>
                <th>Disponibilità</th>
                <th>Azione</th>
            </tr>
        </thead>
        <tbody>
            <!-- I dati dei libri verranno aggiunti qui -->
        </tbody>
    </table>
</div>

<script>
    // ID del foglio di Google Sheets
    const sheetId = '1bHmR_g_8Rp54M1lLnZd3nD78EqRTIKNSzl1mE2-hRzQ';
    
    // API key del progetto Google Cloud
    const apiKey = 'AIzaSyCBAMHlMKwdPs8hlvRnxxNOWwdXxqnKC3k';

    // URL per ottenere i dati dal foglio Google Sheets
    const url = `https://sheets.googleapis.com/v4/spreadsheets/${sheetId}/values/libreriaprincipale?key=${apiKey}`;

    // Funzione per caricare i libri dal Google Sheets
    async function caricaLibri() {
        const response = await fetch(url);
        const data = await response.json();
        const libri = data.values;

        // Seleziona il corpo della tabella dove verranno inseriti i dati
        const tbody = document.querySelector('#libriTable tbody');

        // Rimuoviamo la prima riga poiché contiene i nomi delle colonne
        libri.shift();

        libri.forEach(libro => {
            const [id, titolo, autore, disponibilita] = libro;

            // Creiamo una nuova riga nella tabella per ogni libro
            const tr = document.createElement('tr');

            // Creiamo le celle per ID, Titolo, Autore e Disponibilità
            tr.innerHTML = `
                <td>${id}</td>
                <td>${titolo}</td>
                <td>${autore}</td>
                <td id="disponibilita-${id}">${disponibilita}</td>
                <td>
                    ${disponibilita === 'Disponibile' 
                        ? `<button onclick="prendiInPrestito(${id})">Prendi in Prestito</button>`
                        : `<button onclick="restituisciLibro(${id})">Restituisci</button>`}
                </td>
            `;

            // Aggiungiamo la riga alla tabella
            tbody.appendChild(tr);
        });

setInterval(async () => {
    const response = await fetch(url);
    const data = await response.json();
    const libri = data.values;
    libri.shift();
    libri.forEach(libro => {
        const [id, , , disponibilita] = libro;
        const buttonCell = document.querySelector(`#disponibilita-${id}`).nextElementSibling;
        const disponibilitaCell = document.querySelector(`#disponibilita-${id}`);
        
        if (disponibilita === 'In Prestito') {
            buttonCell.innerHTML = `<button onclick="restituisciLibro(${id})">Restituisci</button>`;
            disponibilitaCell.textContent = 'In Prestito';
        } else {
            buttonCell.innerHTML = `<button onclick="prendiInPrestito(${id})">Prendi in Prestito</button>`;
            disponibilitaCell.textContent = 'Disponibile';
        }
    });
}, 10000); // Controlla ogni 10 secondi


        
    }

  // Funzione per aprire il modulo di prestito con l'ID del libro precompilato
function prendiInPrestito(idLibro) {
    const urlModuloPrestito = `https://docs.google.com/forms/d/e/1FAIpQLScUNgMUgKa_URu74Ju3G1HZXDMVlNMzX1D2egxB7Ut34wzIqg/viewform?entry.1518254211=${idLibro}`;
    window.open(urlModuloPrestito, '_blank');
}

// Funzione per aprire il modulo di restituzione con l'ID del libro precompilato
function restituisciLibro(idLibro) {
    const urlModuloRestituzione = `https://docs.google.com/forms/d/e/1FAIpQLSfqR3bdauSlexTrCqcPnn05kjbOnE4utylDPUoIdRHqheSYCg/viewform?entry.300178690=${idLibro}`;
    window.open(urlModuloRestituzione, '_blank');
}

// Funzione per filtrare i libri in base al titolo o autore
function filtraLibri() {
    // Ottieni il valore dell'input di ricerca
    var input = document.getElementById("searchInput");
    var filtro = input.value.toLowerCase(); // Converte in minuscolo per una ricerca case-insensitive
    
    // Ottieni la tabella e tutte le righe
    var table = document.getElementById("libriTable");
    var tr = table.getElementsByTagName("tr");

    // Loop attraverso tutte le righe della tabella (tr) e nascondi quelle che non corrispondono alla query
    for (var i = 1; i < tr.length; i++) { // Inizia da 1 per saltare l'intestazione della tabella
        var tdTitolo = tr[i].getElementsByTagName("td")[1]; // Colonna Titolo
        var tdAutore = tr[i].getElementsByTagName("td")[2]; // Colonna Autore
        if (tdTitolo || tdAutore) {
            var txtTitolo = tdTitolo.textContent || tdTitolo.innerText;
            var txtAutore = tdAutore.textContent || tdAutore.innerText;
            
            // Se il titolo o l'autore contengono il testo cercato, mostra la riga, altrimenti nascondila
            if (txtTitolo.toLowerCase().indexOf(filtro) > -1 || txtAutore.toLowerCase().indexOf(filtro) > -1) {
                tr[i].style.display = "";
            } else {
                tr[i].style.display = "none";
            }
        }
    }
}

    // Carichiamo i libri appena la pagina viene caricata
    caricaLibri();
</script>

</body>
</html>



